{% extends "base.html" %} {% block content %}
<section class="text-gray-600 body-font">
  <div class="container px-5 py-24 mx-auto">
    <div class="flex flex-col text-center w-full mb-20">
      <h1
        class="sm:text-4xl text-3xl font-medium title-font mb-2 text-gray-900"
      >
        Analytics
      </h1>
      <p class="lg:w-2/3 mx-auto leading-relaxed text-base">
        Banh mi cornhole echo park skateboard authentic crucifix neutra tilde
        lyft biodiesel artisan direct trade mumblecore 3 wolf moon twee
      </p>
    </div>
    <div class="container mx-auto px-4 py-8">
      <!-- Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="border-2 border-gray-200 p-6 rounded-lg">
          <h2 class="text-lg font-medium text-gray-900 title-font mb-2">
            Total Debt
          </h2>
          <p class="leading-relaxed text-2xl">$ {{ debt }}</p>
        </div>

        <div class="border-2 border-gray-200 p-6 rounded-lg">
          <h2 class="text-lg font-medium text-gray-900 title-font mb-2">
            Debt Owed to You
          </h2>
          <p class="leading-relaxed text-2xl">$ {{ debt_owed }}</p>
        </div>

        <div class="border-2 border-gray-200 p-6 rounded-lg">
          <h2 class="text-lg font-medium text-gray-900 title-font mb-2">
            This Month's Expense
          </h2>
          <p class="leading-relaxed text-2xl">$ {{ expense }}</p>
        </div>

        <div class="border-2 border-gray-200 p-6 rounded-lg">
          <h2 class="text-lg font-medium text-gray-900 title-font mb-2">
            Total Payments
          </h2>
          <p class="leading-relaxed text-2xl">{{ payments.length }}</p>
        </div>
      </div>

      <!-- Graphs -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white p-6 rounded-lg shadow">
          <canvas id="paymentsChart"></canvas>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <canvas id="debtChart"></canvas>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <canvas id="expenseChart"></canvas>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
          <canvas id="splitsChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Data for Payments Chart (Line or Bar)
  const paymentsData = {
    labels: {{ payments | map(attribute='time') | list }}, // Dates from payments
    datasets: [{
      label: 'Payments',
      data: {{ payments | map(attribute='amount') | list }}, // Payment amounts
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      borderColor: 'rgba(75, 192, 192, 1)',
      borderWidth: 1
    }]
  };

  const paymentsChartConfig = {
    type: 'line', // You can switch this to 'bar' for a bar chart
    data: paymentsData,
    options: {
      responsive: true,
      scales: {
        x: {
          beginAtZero: true
        }
      }
    }
  };

  const paymentsChart = new Chart(
    document.getElementById('paymentsChart'),
    paymentsChartConfig
  );

  // Data for Debt Chart (Pie or Bar)
  const debtData = {
    labels: ['Debt', 'Debt Owed'],
    datasets: [{
      label: 'Debt Overview',
      data: [{{ debt }}, {{ debt_owed }}], // Debt and Debt Owed
      backgroundColor: ['#FF6384', '#36A2EB'],
      hoverBackgroundColor: ['#FF6384', '#36A2EB']
    }]
  };

  const debtChartConfig = {
    type: 'pie', // You can switch this to 'bar' if you prefer
    data: debtData,
    options: {
      responsive: true
    }
  };

  const debtChart = new Chart(
    document.getElementById('debtChart'),
    debtChartConfig
  );

  // Data for Expense Chart (Bar)
  const expenseData = {
    labels: ['Current Month'],
    datasets: [{
      label: 'Expense',
      data: [{{ expense }}], // Expense for the current month
      backgroundColor: 'rgba(255, 206, 86, 0.2)',
      borderColor: 'rgba(255, 206, 86, 1)',
      borderWidth: 1
    }]
  };

  const expenseChartConfig = {
    type: 'bar',
    data: expenseData,
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  };

  const expenseChart = new Chart(
    document.getElementById('expenseChart'),
    expenseChartConfig
  );

  // Data for Splits Chart (Stacked Bar)
  const splitsData = {
    labels: {{ splits | map(attribute='user.name') | list }}, // Names of users in splits
    datasets: [{
      label: 'Split Amounts',
      data: {{ splits | map(attribute='amount') | list }}, // Split amounts
      backgroundColor: 'rgba(153, 102, 255, 0.2)',
      borderColor: 'rgba(153, 102, 255, 1)',
      borderWidth: 1
    }]
  };

  const splitsChartConfig = {
    type: 'bar',
    data: splitsData,
    options: {
      responsive: true,
      scales: {
        x: {
          stacked: true
        },
        y: {
          stacked: true,
          beginAtZero: true
        }
      }
    }
  };

  const splitsChart = new Chart(
    document.getElementById('splitsChart'),
    splitsChartConfig
  );
</script>

{% endblock %}
